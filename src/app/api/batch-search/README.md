# Batch Search API λ¨λ“ν™” κµ¬μ΅°

## π“‹ κ°μ”

λ°°μΉ κ²€μƒ‰ APIκ°€ λ¨λ“ν™”λμ–΄ μ μ§€λ³΄μμ„±κ³Ό μ¬μ‚¬μ©μ„±μ΄ ν¬κ² ν–¥μƒλμ—μµλ‹λ‹¤.

## π—‚οΈ λ””λ ‰ν† λ¦¬ κµ¬μ΅°

```
/src/app/api/batch-search/
β”β”€β”€ route.ts                    # API μ—”λ“ν¬μΈνΈ (31μ¤„)
β”β”€β”€ route.old.ts                # μ›λ³Έ νμΌ λ°±μ—… (198μ¤„)
β”β”€β”€ README.md                   # μ΄ λ¬Έμ„
β”β”€β”€ types/
β”‚   β””β”€β”€ index.ts               # νƒ€μ… μ •μ (47μ¤„)
β”β”€β”€ utils/
β”‚   β””β”€β”€ index.ts               # μ ν‹Έλ¦¬ν‹° ν•¨μ (70μ¤„)
β””β”€β”€ services/
    β”β”€β”€ database.service.ts    # λ°μ΄ν„°λ² μ΄μ¤ μ„λΉ„μ¤ (126μ¤„)
    β””β”€β”€ search.service.ts      # κ²€μƒ‰ λ΅μ§ μ„λΉ„μ¤ (112μ¤„)
```

## π“ λ¨λ“ν™” μ„±κ³Ό

| ν•­λ© | μ΄μ „ | μ΄ν›„ | κ°μ„ μ¨ |
|------|------|------|---------|
| λ©”μΈ νμΌ ν¬κΈ° | 198μ¤„ | 31μ¤„ | **84% κ°μ†** |
| λ¨λ“ κ°μ | 1κ° | 5κ° | **500% μ¦κ°€** |
| ν•¨μ λ¶„λ¦¬λ„ | λ‚®μ | λ†’μ | **μ™„μ „ λ¶„λ¦¬** |
| μ¬μ‚¬μ©μ„± | μ—†μ | λ†’μ | **ν–¥μƒλ¨** |

## π”§ μ£Όμ” λ¨λ“ μ„¤λ…

### 1. `types/index.ts` - νƒ€μ… μ •μ
- **SubtitleData**: μλ§‰ λ°μ΄ν„° κµ¬μ΅°
- **SearchResult**: κ²€μƒ‰ κ²°κ³Ό κµ¬μ΅°
- **SentenceResult**: λ¬Έμ¥λ³„ κ²€μƒ‰ κ²°κ³Ό
- **BatchSearchRequest**: API μ”μ²­ κµ¬μ΅°
- **BatchSearchResponse**: API μ‘λ‹µ κµ¬μ΅°
- **DatabaseRow**: λ°μ΄ν„°λ² μ΄μ¤ ν–‰ κµ¬μ΅°

### 2. `utils/index.ts` - μ ν‹Έλ¦¬ν‹° ν•¨μ
- **extractEnglishSentences()**: μμ–΄ λ¬Έμ¥ μ¶”μ¶
- **calculateConfidence()**: μ‹ λΆ°λ„ κ³„μ‚°
- **calculateFallbackConfidence()**: ν΄λ°± μ‹ λΆ°λ„ κ³„μ‚°
- **validateSearchRequest()**: μ”μ²­ μ ν¨μ„± κ²€μ‚¬

### 3. `services/database.service.ts` - λ°μ΄ν„°λ² μ΄μ¤ μ„λΉ„μ¤
- **DatabaseService.getDatabase()**: DB μ—°κ²° κ΄€λ¦¬
- **DatabaseService.searchWithFTS()**: FTS κ²€μƒ‰
- **DatabaseService.searchWithLike()**: LIKE ν΄λ°± κ²€μƒ‰
- **DatabaseService.searchInDatabase()**: ν†µν•© κ²€μƒ‰
- **DatabaseService.closeDatabase()**: μ—°κ²° μΆ…λ£

### 4. `services/search.service.ts` - κ²€μƒ‰ μ„λΉ„μ¤
- **SearchService.performBatchSearch()**: λ°°μΉ κ²€μƒ‰ μν–‰
- **SearchService.searchSentences()**: λ¬Έμ¥λ³„ κ²€μƒ‰
- **SearchService.calculateSearchSummary()**: κ²€μƒ‰ μ”μ•½ κ³„μ‚°

### 5. `route.ts` - API μ—”λ“ν¬μΈνΈ
- κ°„κ²°ν• μ—”λ“ν¬μΈνΈ λ΅μ§
- λ…ν™•ν• μ—λ¬ μ²λ¦¬
- μ μ ν• HTTP μƒνƒ μ½”λ“ λ°ν™

## π― κ°μ„ λ νΉμ§•

### 1. **λ‹¨μΌ μ±…μ„ μ›μΉ™ (SRP)**
- κ° λ¨λ“μ΄ ν•λ‚μ λ…ν™•ν• μ±…μ„μ„ κ°€μ§
- ν•¨μλ³„λ΅ μ—­ν• μ΄ λ¶„λ…ν λ¶„λ¦¬λ¨

### 2. **μμ΅΄μ„± μ—­μ „ μ›μΉ™ (DIP)**
- μƒμ„ λ λ²¨ λ¨λ“μ΄ ν•μ„ λ λ²¨ λ¨λ“μ— μμ΅΄ν•μ§€ μ•μ
- μ¶”μƒν™”μ— μμ΅΄ν•λ” κµ¬μ΅°

### 3. **μ¬μ‚¬μ©μ„± ν–¥μƒ**
- μ ν‹Έλ¦¬ν‹° ν•¨μλ“¤μ„ λ‹¤λ¥Έ APIμ—μ„λ„ μ‚¬μ© κ°€λ¥
- μ„λΉ„μ¤ ν΄λμ¤λ¥Ό λ…λ¦½μ μΌλ΅ ν…μ¤νΈ κ°€λ¥

### 4. **μ—λ¬ μ²λ¦¬ κ°μ„ **
- κ° λ λ²¨μ—μ„ μ μ ν• μ—λ¬ μ²λ¦¬
- μƒμ„Έν• λ΅κΉ…μΌλ΅ λ””λ²„κΉ… μ©μ΄

### 5. **νƒ€μ… μ•μ •μ„±**
- λ¨λ“  λ°μ΄ν„° κµ¬μ΅°μ— TypeScript νƒ€μ… μ μ©
- μ»΄νμΌ νƒ€μ„ μ—λ¬ λ°©μ§€

## π”„ API μ‚¬μ©λ²•

### μ”μ²­ μμ‹
```typescript
POST /api/batch-search
Content-Type: application/json

{
  "text": "Hello world\nHow are you\nGoodbye",
  "results_per_sentence": 20
}
```

### μ‘λ‹µ μμ‹
```typescript
{
  "success": true,
  "extracted_sentences": ["Hello world", "How are you", "Goodbye"],
  "search_summary": {
    "total_sentences": 3,
    "total_results": 45,
    "average_per_sentence": "15.0",
    "search_time": 1.2
  },
  "sentence_results": [...],
  "auto_create_clips": true
}
```

## π€ ν–¥ν›„ κ°μ„  κ³„ν

### μ¦‰μ‹ κ°€λ¥ν• κ°μ„ 
1. **λ‹¨μ„ ν…μ¤νΈ μ‘μ„±** - κ° μ„λΉ„μ¤λ³„ ν…μ¤νΈ μ½”λ“
2. **μ„±λ¥ μΈ΅μ •** - μ‹¤μ  κ²€μƒ‰ μ‹κ°„ μΈ΅μ • λ΅μ§ μ¶”κ°€
3. **μΊμ‹± κµ¬ν„** - μμ£Ό κ²€μƒ‰λλ” μΏΌλ¦¬ μΊμ‹±

### μ¤‘μ¥κΈ° κ°μ„ 
1. **κ²€μƒ‰ μ•κ³ λ¦¬μ¦ μµμ ν™”** - λ” μ •ν™•ν• λ§¤μΉ­ μ•κ³ λ¦¬μ¦
2. **λ³‘λ ¬ μ²λ¦¬** - μ—¬λ¬ λ¬Έμ¥ λ™μ‹ κ²€μƒ‰
3. **λ¨λ‹ν„°λ§ μ¶”κ°€** - κ²€μƒ‰ μ„±λ¥ λ° μ¤λ¥ λ¨λ‹ν„°λ§

## β¨ μ•„ν‚¤ν…μ² ν’μ§ ν–¥μƒ

### Before (Monolithic)
```
route.ts (198μ¤„)
β”β”€β”€ λ¨λ“  λ΅μ§μ΄ ν• νμΌμ— μ§‘μ¤‘
β”β”€β”€ λ†’μ€ κ²°ν•©λ„, λ‚®μ€ μ‘μ§‘λ„
β””β”€β”€ ν…μ¤νΈ λ° μ μ§€λ³΄μ μ–΄λ ¤μ›€
```

### After (Modular)
```
route.ts (31μ¤„)
β”β”€β”€ types/     - νƒ€μ… μ •μ λ¶„λ¦¬
β”β”€β”€ utils/     - μμ ν•¨μ λ¶„λ¦¬
β””β”€β”€ services/  - λΉ„μ¦λ‹μ¤ λ΅μ§ λ¶„λ¦¬
    β”β”€β”€ database.service.ts
    β””β”€β”€ search.service.ts
```

μ΄μ  λ°°μΉ κ²€μƒ‰ APIλ„ Results νμ΄μ§€μ™€ λ™μΌν•κ² κΉ”λ”ν•κ³  μ μ§€λ³΄μν•κΈ° μ‰¬μ΄ λ¨λ“ν™”λ κµ¬μ΅°λ¥Ό κ°–κ² λμ—μµλ‹λ‹¤!
